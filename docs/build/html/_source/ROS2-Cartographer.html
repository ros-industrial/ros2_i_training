

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>ROS2-Cartographer &mdash; ROS2 workshop  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ROS2 Navigation" href="ROS2-Navigation.html" />
    <link rel="prev" title="TF2 - The second generation of the transform library" href="ROS2-TF2.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> ROS2 workshop
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="ROS2-Filesystem.html">Exercise 1.0 - ROS2 filesystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="ROS2-Simple-Publisher-Subscriber.html">Exercise 1.1 - ROS2-Simple-Publisher-Subscriber</a></li>
<li class="toctree-l1"><a class="reference internal" href="ROS2-Turtlebot.html">Exercise 1.2 - ROS2-Turtlebot</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ROS2-TF2.html">Exercise 2.1 - ROS2-TF2</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Exercise 2.2 - ROS2-Cartographer</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#general-approach">2. General approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="#start-cartographer">3. Start Cartographer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#technical-overview">3.1 Technical Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-cartographer">3.2 Install cartographer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#check-if-there-is-turtlebot3-package">Check if there is turtlebot3* package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#startup-system-of-turtlebot-and-teleoperation">3.3 Startup system of turtleBot and teleoperation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#simulation">3.3.1 Simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#real-robot">3.3.2 Real robot</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-teleoperation-node">3.3.3 Run teleoperation node</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#run-slam-nodes">3.4 Run SLAM nodes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#save-the-map">4. Save the Map</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ROS2-Navigation.html">Exercise 2.3 - ROS2-Navigation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ROS2 workshop</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>ROS2-Cartographer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/_source/ROS2-Cartographer.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ros2-cartographer">
<h1>ROS2-Cartographer<a class="headerlink" href="#ros2-cartographer" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The goal of this tutorial is to</p>
<ul>
<li><p>use Cartographer to create a map of environment</p></li>
</ul>
</li>
<li><p>The packages that will be used:</p>
<ul>
<li><p>cartographer</p></li>
<li><p>cartographer-ros</p></li>
<li><p>turtlebot3_cartographer</p></li>
<li><p>turtlebot3_teleop</p></li>
<li><p>turtlebot3_gazebo</p></li>
</ul>
</li>
</ul>
<p>This tutorial explains how to use the Cartographer for mapping and localization.</p>
<ul class="simple">
<li><p>Lines beginning with <code class="docutils literal notranslate"><span class="pre">$</span></code> indicates the syntax of these commands.
Commands are executed in a terminal:</p>
<ul>
<li><p>Open a new terminal → use the shortcut ctrl+alt+t.
Open a new tab inside an existing terminal → use the shortcut ctrl+shift+t.</p></li>
</ul>
</li>
<li><p>Info: The computer of the real robot will be accessed from your local computer remotely. For every further command, a tag will inform which computer has to be used. It can be either <code class="docutils literal notranslate"><span class="pre">[TurtleBot]</span></code> or <code class="docutils literal notranslate"><span class="pre">[Remote</span> <span class="pre">PC]</span></code>.</p></li>
</ul>
</div>
<div class="section" id="general-approach">
<h2>2. General approach<a class="headerlink" href="#general-approach" title="Permalink to this headline">¶</a></h2>
<p>The main problem in mobile robotics is localization and mapping. To estimate the position of the robot in an environment, you need some kind of map from this environment to determine the actual position in this environment. On the other hand, you need the actual position of robots to create a map related to its position. Therefore you can use SLAM – Simultaneous Localization and Mapping. ROS provides different
packages to solve this problem:</p>
<ul class="simple">
<li><p><strong>2D</strong>: gmapping, hector_slam, cartographer, ohm_tsd_slam…</p></li>
<li><p><strong>3D</strong>: rgbdslam, ccny_rgbd, lsd_slam, rtabmap…</p></li>
</ul>
<p>For ground-based robots, it is often sufficient to use 2D SLAM to navigate through the environment. In the following tutorial, cartographer will be used. Cartographer SLAM builds a map of the environment and simultaneously estimates the platform’s 2D pose. The localization is based on a laser scan and the odometry of the robot.</p>
</div>
<div class="section" id="start-cartographer">
<h2>3. Start Cartographer<a class="headerlink" href="#start-cartographer" title="Permalink to this headline">¶</a></h2>
<div class="section" id="technical-overview">
<h3>3.1 Technical Overview<a class="headerlink" href="#technical-overview" title="Permalink to this headline">¶</a></h3>
<p><img alt="Technical Overview" src="_source/../../_static/high_level_system_overview.png" /></p>
<p>Figure 1: Technical Overview</p>
<p>source: <a class="reference external" href="https://google-cartographer.readthedocs.io/en/latest/">cartographer</a></p>
</div>
<div class="section" id="install-cartographer">
<h3>3.2 Install cartographer<a class="headerlink" href="#install-cartographer" title="Permalink to this headline">¶</a></h3>
<p>Install cartographer by performing the following:</p>
<p><strong>Before installing package, you need to make sure which ROS  Distro you are using.</strong></p>
<p>After sourcing ROS2, you will get $ROS_DISTRO in evironment values.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># source ROS2</span>
$ <span class="nb">source</span> /opt/ros/foxy/setup.bash
$ <span class="nb">echo</span> <span class="nv">$ROS_DISTRO</span>
You will get <span class="s2">&quot;foxy&quot;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt install ros-<span class="nv">$ROS_DISTRO</span>-cartographer ros-<span class="nv">$ROS_DISTRO</span>-cartographer-ros  
</pre></div>
</div>
<div class="section" id="check-if-there-is-turtlebot3-package">
<h4>Check if there is turtlebot3* package<a class="headerlink" href="#check-if-there-is-turtlebot3-package" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ros2 pkg list <span class="p">|</span> grep turtlebot3
</pre></div>
</div>
<p>if not you can install these package by performing the following:</p>
<p>First entering your workspace</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ wget https://raw.githubusercontent.com/ROBOTIS-GIT/turtlebot3/foxy-devel/turtlebot3.repos
</pre></div>
</div>
<p>Make sure you have “src” folder, then run this command to get source code for turtlebot3</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ vcs import src&lt;turtlebot3.repos
</pre></div>
</div>
<p>Source your ROS2 installation workspace and install dependencies</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">source</span> /opt/ros/foxy/setup.bash
$ rosdep update
$ rosdep install --from-paths src --ignore-src --rosdistro 
<span class="nv">$ROS_DISTRO</span> -y
</pre></div>
</div>
<p>Compile codes</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ colcon build
</pre></div>
</div>
<p>Source your workspace</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">source</span> install/setup.bash
</pre></div>
</div>
</div>
</div>
<div class="section" id="startup-system-of-turtlebot-and-teleoperation">
<h3>3.3 Startup system of turtleBot and teleoperation<a class="headerlink" href="#startup-system-of-turtlebot-and-teleoperation" title="Permalink to this headline">¶</a></h3>
<p><strong>Please try simulation first</strong></p>
<div class="section" id="simulation">
<h4>3.3.1 Simulation<a class="headerlink" href="#simulation" title="Permalink to this headline">¶</a></h4>
<p>a. Simulation in gazebo</p>
<p>Here we use 11 as ROS Domain ID</p>
<ol>
<li><p>Set up ROS_DOMAIN_ID</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">ROS_DOMAIN_ID</span><span class="o">=</span><span class="m">11</span>
</pre></div>
</div>
</li>
<li><p>Set up turtlebot model</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">TURTLEBOT3_MODEL</span><span class="o">=</span>burger
</pre></div>
</div>
</li>
<li><p>Set up Gazebo model path</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">GAZEBO_MODEL_PATH</span><span class="o">=</span><span class="sb">`</span>ros2 pkg <span class="se">\</span>
prefix turtlebot3_gazebo<span class="sb">`</span>/share/turtlebot3_gazebo/models/
</pre></div>
</div>
</li>
<li><p>Launch Gazebo with a simulation world</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ros2 launch turtlebot3_gazebo turtlebot3_world.launch.py
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="real-robot">
<h4>3.3.2 Real robot<a class="headerlink" href="#real-robot" title="Permalink to this headline">¶</a></h4>
<p>[TurtleBot3]</p>
<p>a. open a terminal and use <code class="docutils literal notranslate"><span class="pre">ssh</span></code> connect to Turtlebot3.</p>
<p>b. bring up basic packages to start its applications.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">source</span> .bashrc
$ <span class="nb">cd</span> turtlebot3_ws
$ <span class="nb">source</span> install/setup.bash
$ ros2 launch turtlebot3_bringup robot.launch.py
</pre></div>
</div>
</div>
<div class="section" id="run-teleoperation-node">
<h4>3.3.3 Run teleoperation node<a class="headerlink" href="#run-teleoperation-node" title="Permalink to this headline">¶</a></h4>
<p>[Remote PC]</p>
<ol>
<li><p>Open a new terminal</p></li>
<li><p>Make sure you are in the workspace which you created at the beginning.</p></li>
<li><p>Then source your workspace.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">source</span> install/setup.bash
</pre></div>
</div>
</li>
<li><p>Set up ROS_DOMAIN_ID</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">ROS_DOMAIN_ID</span><span class="o">=</span><span class="m">11</span>
</pre></div>
</div>
</li>
<li><p>Set up turlebot model</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">TURTLEBOT3_MODEL</span><span class="o">=</span>burger
</pre></div>
</div>
</li>
<li><p>Run teleoperation node</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ros2 run turtlebot3_teleop teleop_keyboard
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="run-slam-nodes">
<h3>3.4 Run SLAM nodes<a class="headerlink" href="#run-slam-nodes" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>open a new terminal on Remote PC and enter your workspace</p></li>
<li><p>source your workspace</p></li>
<li><p>export ROS domain id which is same as the one for TurtleBot</p>
<p><code class="docutils literal notranslate"><span class="pre">[Remote</span> <span class="pre">PC]</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">ROS_DOMAIN_ID</span><span class="o">=</span><span class="m">11</span>
</pre></div>
</div>
</li>
<li><p>run the SLAM nodes</p>
<p>If you are using simulation, you need to use simulation time. You can set <code class="docutils literal notranslate"><span class="pre">use_sim_time</span></code> to True.</p>
<p><strong>a. Simulation</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">[Remote</span> <span class="pre">PC]</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ros2 launch turtlebot3_cartographer <span class="se">\</span>
cartographer.launch.py <span class="se">\</span>
use_sim_time:<span class="o">=</span>True
</pre></div>
</div>
<p><strong>b. For a real robot</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">[Remote</span> <span class="pre">PC]</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ros2 run cartographer_ros occupancy_grid_node -resolution <span class="m">0</span>.05<span class="se">\</span>
-publish_period_sec <span class="m">1</span>.0

$ ros2 run cartographer_ros cartographer_node<span class="se">\</span>
-configuration_directory<span class="o">]</span><span class="se">\ </span>
install/turtlebot3_cartographer/share/turtlebot3_cartographer<span class="se">\</span>
/config -configuration_basename turtlebot3_lds_2d.lua
</pre></div>
</div>
</li>
<li><p>create a map</p>
<p><em><strong>Hint: Make sure that the Fixed Frame (in Global Options) in RViz is set to “map”.</strong></em></p>
<p>In this way the map is fixed and the robot will move relative to it.
The scanner of the Turtlebot3 covers 360 degrees of its surroundings. Thus, if objects are close by to the robot it will start to generate the map.</p>
<p>Teleoperate the robot through the physical world until the enclosed environment is completely covered in the virtual map.</p>
<p>The following hints help you to create <strong>a nice map</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">Try</span> <span class="n">to</span> <span class="n">drive</span> <span class="k">as</span> <span class="n">slow</span> <span class="k">as</span> <span class="n">possible</span>
<span class="o">*</span> <span class="n">Avoid</span> <span class="n">to</span> <span class="n">drive</span> <span class="n">linear</span> <span class="ow">and</span> <span class="n">rotate</span> <span class="n">at</span> <span class="n">the</span> <span class="n">same</span> <span class="n">time</span>
<span class="o">*</span> <span class="n">Do</span> <span class="ow">not</span> <span class="n">drive</span> <span class="n">too</span> <span class="n">close</span> <span class="n">to</span> <span class="n">the</span> <span class="n">obstacles</span>
</pre></div>
</div>
<p>In the left menu of RViz you can see several display modules. There is e.g. the RobotModel which is virtual visualization of the robot.</p>
<p>Furthermore, you can visualize the transforms of the available frames by checking the box of tf. Make yourself familiar with the available modules.</p>
<p><img alt="Map at startup" src="_source/../../_static/beforemap.png" />
Figure 2: A incomplete map at beginning in the real work setup</p>
<p><img alt="Final Map" src="_source/../../_static/aftermap2.png" />
Figure 3: A complete map at beginning in the real work setup</p>
</li>
</ol>
</div>
</div>
<div class="section" id="save-the-map">
<h2>4. Save the Map<a class="headerlink" href="#save-the-map" title="Permalink to this headline">¶</a></h2>
<p>If you are satisfied with your map you can store it. Open a new terminal and run the map saver node.</p>
<p><code class="docutils literal notranslate"><span class="pre">[Remote</span> <span class="pre">PC]</span></code></p>
<p>First you need to source workspace and set up ROS Domain ID that is same as before.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ros2 run nav2_map_server map_saver_cli 
</pre></div>
</div>
<p>You also can define a name of the map by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ros2</span> <span class="n">run</span> <span class="n">nav2_map_server</span> <span class="n">map_saver_cli</span> <span class="o">-</span><span class="n">f</span> <span class="n">my_map</span>
</pre></div>
</div>
<p>If the terminal’s path is “your workspace” they can be found in “your workspace” directory. An example of the map.pgm image is given in the following.</p>
<p><img alt="Map" src="_source/../../_static/map.jpg" /></p>
<p>The node will create a map.pgm and a map.yaml files in the current directory, which is in this case the home directory.</p>
<p><em><strong>Hint: The signs “~/” is a direct path to the home directory which works from every relative path.</strong></em></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="ROS2-Navigation.html" class="btn btn-neutral float-right" title="ROS2 Navigation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="ROS2-TF2.html" class="btn btn-neutral float-left" title="TF2 - The second generation of the transform library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Fraunhofer IPA.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>